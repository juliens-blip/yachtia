#!/bin/bash
# Run Phase C+D tests with proper env export

cd "$(dirname "$0")/.."

echo "ğŸ”§ Exporting environment variables..."

# Parse .env.local safely
set -a
source .env.local 2>/dev/null
set +a

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ§ª PHASE C: Threshold Adaptatif + Boost Official Docs"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

npx tsx test-scripts/test-threshold-boost.ts

PHASE_C_EXIT=$?

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ§ª PHASE D: Multi-Aspect Structure + Multi-Sources"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

npx tsx test-scripts/test-multi-aspect-complete.ts

PHASE_D_EXIT=$?

echo ""
if [ $PHASE_C_EXIT -eq 0 ] && [ $PHASE_D_EXIT -eq 0 ]; then
  echo "âœ… ALL TESTS PASSED - T040 Phase C+D COMPLETE"
  exit 0
else
  echo "âš ï¸  SOME TESTS FAILED - Check logs above"
  exit 1
fi
