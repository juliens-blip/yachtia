# üéØ MISSION CLAUDE - Prompts & Tests Perplexity

**Assign√© √†:** CLAUDE (Orchestrateur)  
**Date:** 2026-01-24  
**Priorit√©:** HIGH  
**D√©pendances:** T011-T013 (CODEX) - mais peut commencer en parall√®le

---

## üìã Mes TODOs

### T014-CLAUDE: Prompt Fusion Multi-Sources Gemini

**Probl√®me:** IA se contente de 1-2 documents, ne fusionne pas OGSR + Merchant Shipping Act + Registration Process

**Solution:**
1. Renforcer prompt Gemini dans `lib/gemini.ts`
2. Nouvelles r√®gles STRICTES:
   - MINIMUM 5 documents diff√©rents analys√©s
   - Croiser CODE + OGSR + GUIDE cabinet obligatoire
   - Si <3 sources diff√©rentes cit√©es ‚Üí REFUSER r√©ponse "base insuffisante"
   - Format citation: `[CODE LY3 p.12] + [OGSR Malta ¬ß4.2] + [TMF Guide 2024]`

### T015-CLAUDE: Filtrage Anti-Bruit Documents

**Probl√®me:** Question Malte ‚Üí sources Monaco/VAT Italie dans r√©ponse

**Solution:**
1. Cr√©er `lib/document-filter.ts`
2. Avant envoi chunks √† Gemini:
   - V√©rifier pavillon match (si question mentionne "Malta" ‚Üí √©liminer chunks Cayman/Monaco)
   - V√©rifier th√®me (question "eligibility" ‚Üí √©liminer chunks VAT/insurance)
3. Logger chunks √©limin√©s pour debug
4. Int√©grer dans `lib/rag-pipeline.ts`

### T016-CLAUDE: Tests E2E Validation Perplexity

**Probl√®me:** Pas de tests pour cas r√©els signal√©s par Perplexity

**Solution:**
1. Cr√©er `scripts/test-e2e-perplexity.ts`
2. Test cases:
   - **Malta 45m built 2000:** "Quelles sont les conditions d'√©ligibilit√© et inspections pour un yacht 45m construit en 2000 sous pavillon Malta?"
     - Valider: 5+ sources, OGSR Malta + Merchant Shipping Act + guides cabinets
     - Valider: mentions inspections √¢ge (>25 ans)
     - Valider: 0% bruit (pas Monaco/Cayman)
   - **Cayman REG 50m:** "Quelles obligations selon LY3 et REG Yacht Code pour un yacht commercial 50m sous pavillon Cayman?"
     - Valider: LY3 + REG Yacht Code en top-3 sources
     - Valider: d√©finition "large commercial yacht"
     - Valider: mentions MLC/SOLAS (>500 GT probable)

---

## üìù Plan d'Ex√©cution

**Phase 1: T014 - Prompt Fusion (20 min)**
- Lire prompt actuel `lib/gemini.ts`
- Ajouter r√®gles multi-sources strictes
- Tester avec question Malta

**Phase 2: T015 - Filtrage Bruit (15 min)**
- Cr√©er `lib/document-filter.ts`
- Int√©grer dans pipeline RAG
- Logger √©liminations

**Phase 3: T016 - Tests E2E (20 min)**
- Cr√©er script tests
- Runner 2 cas Perplexity
- Valider crit√®res succ√®s

**Phase 4: Monitoring CODEX (continu)**
- V√©rifier `/home/julien/Documents/iayacht/tasks/CODEX_COMPLETED_T011_T012_T013.md`
- Quand CODEX termine ‚Üí int√©grer ses livrables dans mes tests
- Si CODEX bloqu√© ‚Üí prendre le relais

---

**Start Time:** 2026-01-24 11:05  
**Status:** üöÄ EN COURS
