â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¤– MISSION URGENTE - ANTIGRAVIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Orchestrateur: Claude
PrioritÃ©: HIGH
DurÃ©e: 1.5h max
Status: â³ EN ATTENTE DE TON DÃ‰MARRAGE

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ CONTEXTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Projet: Yacht Legal AI (RAG + Gemini)
Repo: /home/julien/Documents/iayacht/yacht-legal-ai

PROBLÃˆME: Gemini analyse superficiellement les PDFs et fallback sur internet trop vite.
SOLUTION: Renforcer prompt + question expansion + logging dÃ©taillÃ©

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ TES 3 TÃ‚CHES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TODO 1: RENFORCER SYSTEM PROMPT GEMINI
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Fichier: lib/gemini.ts
Fonction: generateAnswer()

NOUVEAU SYSTEM PROMPT (remplacer l'actuel):

```
Tu es un assistant juridique maritime expert.

RÃˆGLES D'ANALYSE DES DOCUMENTS (PRIORITÃ‰ ABSOLUE):

1. ANALYSE PROFONDE OBLIGATOIRE
   - Lire ATTENTIVEMENT tous les chunks fournis
   - Ne PAS se contenter d'un survol
   - Chercher dans TOUS les passages pertinents

2. CITATIONS PRÃ‰CISES REQUISES
   - Format: [Source: {nom_doc}, page {num}]
   - Extraire citations textuelles si pertinent
   - Exemple: "Selon l'article 5.2: '...' [Source: Code Maritime, page 42]"

3. TRANSPARENCE SUR LES LIMITES
   - Si pas de rÃ©ponse dans docs â†’ EXPLIQUER POURQUOI
   - Format:
     ğŸ“š Documents consultÃ©s: [liste]
     âŒ Information manquante: [dÃ©tail]
     ğŸ’¡ Suggestion: [action]

4. FALLBACK INTERNET EN DERNIER RECOURS
   - Uniquement si aucune info dans chunks
   - Justification claire requise
   - PrÃ©ciser quand info vient d'internet vs docs

PROCESSUS:
1. Analyser la question
2. Explorer TOUS les chunks
3. SynthÃ©tiser avec citations
4. VÃ©rifier complÃ©tude

STYLE: Professionnel, structurÃ©, prÃ©cis, humain (pas "robot lawyer")
```

TODO 2: PRÃ‰-PROCESSING QUESTIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Nouveau fichier: lib/question-processor.ts

Fonction Ã  crÃ©er:
```typescript
export async function expandQuery(question: string): Promise<{
  original: string;
  variants: string[];
  keywords: string[];
}> {
  // 1. Extraire keywords juridiques
  const keywords = extractLegalKeywords(question);
  
  // 2. GÃ©nÃ©rer 2-3 variantes sÃ©mantiques
  const variants = generateVariants(question);
  
  return { original: question, variants, keywords };
}
```

IntÃ©grer dans: app/api/chat/route.ts
- Chercher avec original + variantes
- DÃ©dupliquer chunks
- Passer merged chunks Ã  Gemini

TODO 3: LOGGING DÃ‰TAILLÃ‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Nouveau fichier: lib/gemini-logger.ts

Fonctions:
1. logGeminiInteraction(data) â†’ console + file logs/gemini-rag.log
2. extractCitations(response) â†’ parse [Source: ...]
3. detectInternetFallback(response) â†’ detect internet patterns

Structure log:
{
  timestamp,
  question,
  chunksProvided,
  chunksPreviews,
  response,
  sourcesCited,
  usedInternet,
  latency
}

IntÃ©grer dans: lib/gemini.ts (fonction generateAnswer)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ§ª TEST MANUEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```bash
npm run dev

# Autre terminal:
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "Quelles sont les obligations du vendeur?"}' \
  | jq '.sources'

tail -f logs/gemini-rag.log
```

VÃ©rifier:
âœ… RÃ©ponse avec 3+ citations [Source: ...]
âœ… Pas de fallback internet si chunks pertinents
âœ… Logs dÃ©taillÃ©s prÃ©sents

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š CRITÃˆRES DE SUCCÃˆS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… System prompt renforcÃ© (analyse profonde)
âœ… Question expansion (2-3 variantes)
âœ… Logging complet (gemini-logger.ts)
âœ… Test manuel: 3+ citations PDF
âœ… Fallback internet justifiÃ© uniquement

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ LIVRABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RÃ©pondre avec:
1. Fichiers modifiÃ©s (lib/gemini.ts, app/api/chat/route.ts)
2. Nouveaux fichiers (question-processor.ts, gemini-logger.ts)
3. Screenshot/copie rÃ©ponse avec citations
4. Extrait logs/gemini-rag.log

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ CONTRAINTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

- Garder ton conversationnel (pas robot)
- Ne PAS casser API /api/chat
- Logger sans impact perf (<50ms)
- Tester avant de livrer

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ ANTIGRAVIT, DÃ‰MARRE MAINTENANT !

Confirme rÃ©ception et commence par TODO 1.
